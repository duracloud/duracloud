<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

  <!-- REST API resources -->
  <bean id="storageReportRest" class="org.duracloud.duraboss.rest.report.StorageReportRest" >
    <constructor-arg ref="storageResource"/>
  </bean>  

  <bean id="serviceReportRest" class="org.duracloud.duraboss.rest.report.ServiceReportRest" >
    <constructor-arg ref="serviceResource"/>
  </bean>

  <bean id="execRest" class="org.duracloud.duraboss.rest.exec.ExecRest" >
    <constructor-arg ref="execResource"/>
    <constructor-arg ref="restUtil"/>
  </bean>

  <bean id="auditRest" class="org.duracloud.duraboss.rest.audit.AuditRest" >
    <constructor-arg ref="auditResource"/>
  </bean>

  <bean id="initRest" class="org.duracloud.duraboss.rest.InitRest" >
    <constructor-arg ref="storageResource"/>
    <constructor-arg ref="serviceResource"/>
    <constructor-arg ref="summaryDirectory"/>
    <constructor-arg ref="securityContextUtil"/>
    <constructor-arg ref="restUtil"/>
    <constructor-arg ref="report-space"/>
    <constructor-arg ref="notificationManager"/>
    <constructor-arg ref="executor"/>
    <constructor-arg ref="auditor"/>
  </bean>

  <bean id="securityRest" class="org.duracloud.duraboss.rest.SecurityRest">
    <constructor-arg ref="userDetailsSvc" />
    <constructor-arg ref="restUtil"/>
  </bean>

  <!-- Support beans -->
  <bean id="storageResource" class="org.duracloud.duraboss.rest.report.StorageReportResource"
        destroy-method="dispose">
    <constructor-arg value="report/storage-report-"/>
    <constructor-arg value="report/error-log-storage-report.txt"/>
  </bean>

  <bean id="serviceResource" class="org.duracloud.duraboss.rest.report.ServiceReportResource" >
    <constructor-arg ref="serviceMonitor"/>
    <constructor-arg ref="serviceNotificationMonitor"/>
  </bean>

  <bean id="execResource" class="org.duracloud.duraboss.rest.exec.ExecResource" >
    <constructor-arg ref="executor"/>
  </bean>

  <bean id="executor" class="org.duracloud.exec.impl.ExecutorImpl">
    <constructor-arg>
      <list>
        <bean class="org.duracloud.exec.handler.BitIntegrityHandler">
          <constructor-arg value="bit-integrity-results.json"/>
        </bean>
        <bean class="org.duracloud.exec.handler.DuplicationHandler"/>
        <bean class="org.duracloud.exec.handler.ImageServerHandler"/>
        <bean class="org.duracloud.exec.handler.MediaStreamingHandler"/>
      </list>
    </constructor-arg>
  </bean>

  <bean id="auditResource" class="org.duracloud.duraboss.rest.audit.AuditResource">
    <constructor-arg ref="auditor"/>
  </bean>

  <bean id="auditor" class="org.duracloud.audit.impl.AuditorImpl">
    <constructor-arg ref="auditListener"/>
    <constructor-arg ref="auditLogStore"/>
  </bean>

  <bean id="auditLogStore" class="org.duracloud.audit.impl.AuditLogStoreImpl">
    <constructor-arg ref="auditLogSpace"/>
    <constructor-arg value="audit/storage-audit-log-"/>
    <constructor-arg value="10000000"/> <!-- 10-MB -->
  </bean>

  <bean id="auditLogSpace" class="java.lang.String">
    <constructor-arg value="x-duracloud-admin"/>
  </bean>

  <bean id="auditListener" class="org.duracloud.audit.impl.AuditListenerImpl">
    <constructor-arg ref="auditLogStore"/>
    <constructor-arg value="60000"/> <!-- 1 minute delay -->
  </bean>

  <bean id="summaryDirectory" class="org.duracloud.servicemonitor.impl.ServiceSummaryDirectoryImpl">
    <constructor-arg ref="report-space"/>
    <constructor-arg value="report/service-summaries-$DATE.xml"/>
  </bean>

  <bean id="report-space" class="java.lang.String">
    <constructor-arg value="x-duracloud-admin"/>
  </bean>

  <bean id="serviceMonitor" class="org.duracloud.servicemonitor.impl.ServiceMonitorImpl"
    destroy-method="dispose"/>

  <bean id="restUtil" class="org.duracloud.common.rest.RestUtilImpl"/>

  <bean id="securityContextUtil" class="org.duracloud.security.context.SecurityContextUtil"/>

</beans>